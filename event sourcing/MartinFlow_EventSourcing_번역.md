# Event Sourcing (번역)

## 이벤트 소싱이란?

이벤트 소싱은 애플리케이션의 모든 상태 변경을 이벤트 객체로 저장하고 이를 순차적으로 관리하는 방법입니다. 예를 들어, 배의 위치를 추적하는 시스템에서 배가 항구에 도착하거나 떠날 때마다 그 상황을 이벤트로 저장합니다.

## How it Works, 어떻게 동작하는가?

1. **전체 재구축(Complete Revuild) :** 이벤트 로그만 있으면 언제든지 애플리케이션의 상태를 처음부터 다시 만들 수 있습니다.
2. **시간에 따른 쿼리(Temporal Query) : **특정 시점의 애플리케이션 상태를 알 수 있습니다. 이벤트를 처음부터 그 시점까지 재생하여 알아낼 수 있습니다.
3. **이벤트 재생(Event Replay) : **잘못된 이벤트를 수정하거나 순서를 바로잡을 수 있습니다.

## Application State Storage, 애플리케이션 상태 저장

애플리케이션 상태는 메모리 또는 디스크에 저장될 수 있으며, 이 상태는 이벤트 로그에서 파생될 수 있기 때문에 어디에나 캐시할 수 있습니다. 이벤트 로그와 현재 애플리케이션 상태 중 어느 것이 공식 레코드(official system of record)가 될지는 선택 사항입니다.

## Structuring the Event Handler Logic, 이벤트 핸들러 로직 구조화

이벤트를 처리하는 로직은 Transaction Scripts나 Domain Model에 넣을 수 있습니다. Transaction Scripts는 단순한 로직에, Domain Model은 복잡한 로직에 더 적합합니다.

이벤트 소싱은 애플리케이션의 상태 변경을 투명하게 추적하면서, 복잡한 쿼리나 상태 복구, 이벤트 수정 등 다양한 작업을 가능하게 하는 기법입니다. 이를 통해 더 안정적이고 유지보수가 쉬운 시스템을 구축할 수 있습니다.

## 이벤트 소싱과 관련된 다양한 문제점 및 해결 방안

### Reversing Events, 이벤트의 역전

이벤트 소싱에서 이벤트를 역으로 처리할 수 있는 기능이 있으면 유용합니다. 이벤트가 "차이" 형태로 주어진다면 역전이 쉽습니다. 예를 들어, "마틴의 계좌에 10$를 추가"는 "마틴의 계좌를 110$로 설정"에 비해 역전하기 쉽습니다.

이벤트 스트림을 처음부터 재생하여 과거 상태로 돌아갈 수도 있지만, 이벤트를 역전하는 것이 효율적일 수 있습니다.

### External Updates, 외부 업데이트

외부 시스템과의 상호작용이 문제가 될 수 있습니다. 이벤트 재생과 혼동을 피하기 위해 외부 시스템을 [게이트웨이](https://martinfowler.com/eaaCatalog/gateway.html)로 감쌀 필요가 있습니다. 재생 중에는 게이트웨이를 비활성화할 수 있습니다.

### External Queries, 외부 쿼리

외부 시스템에서 데이터를 쿼리할 때 일관된 재생을 위해 과거 데이터가 필요합니다. 게이트웨이는 쿼리 응답을 기억해야 할 수도 있습니다.

### External Interaction, 외부 상호작용

쿼리와 업데이트가 모두 포함된 상호작용은 복잡합니다.

### Code Changes, 코드 변경

새로운 기능, 결함 수정, 시간에 따른 로직 변경 등 세 가지 유형의 코드 변경이 있습니다. 

새 기능은 이벤트를 재처리하면 적용됩니다. 버그 수정은 내부적으로는 쉽지만, 외부 게이트웨이와 관련될 경우 복잡해집니다. 시간에 따른 로직 변경은 도메인 모델 자체에 구현해야 합니다.

이러한 문제들은 데이터에 코드를 포함시켜 해결할 수도 있습니다. 하지만 이 경우에도 제대로된 설정 관리가 필요합니다.

### Events and Accounts, 이벤트와 회계

이벤트 소싱은 회계 시스템에서 강력하게 작용하며, 감사(audit)와 같은 요구 사항을 충족시키는 데 도움이 됩니다.

회계 입력(Accounting Entries)은 계정(Account)의 값을 변경하는 이벤트의 로그로 볼 수 있으며, 이는 이벤트 소싱의 한 예입니다.

### When to Use It, 언제 사용해야 하는가?

- 감사 로그(Audit Log)의 생성이 쉽습니다. 
- 디버깅에 유용하며, 이벤트를 재생하여 테스트 환경에서 문제를 파악할 수 있습니다. 
- 병렬 모델(Parallel Models) 또는 소급 이벤트(Retroactive Events) 같은 패턴을 사용하려면 이벤트 소싱이 핑요합니다. 
- 이벤트 중심의 아키텍처는 확장성과 시스템 실패에 대한 탄력성이 뛰어납니다.

### 장단점과 고려 사항

- 이벤트 소싱을 사용하면 시스템 간에 느슨하게 결합된 통신이 가능합니다.
- 하지만 이벤트 전파의 시간 차로 인해 리더 시스템이 마스터와 동기화되지 않을 수도 있습니다.