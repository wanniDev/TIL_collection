# NCP로 나만의 서비스 구축해보기-1- DNS

한참 진행중인 결제 서비스 프로젝트(https://github.com/f-lab-edu/payment-lab)에 실제 도메인을 적용하고 ssl을 적용해보기로 했습니다. 한동안 비즈니스 로직에 대한 고민을 했지만, 대부분의 의미 있는 고민은 실제 프로덕션 환경에서 비롯된다는 점을 알게 되었습니다.

특히 오랜기간 학습하고 개발을 진행중이던 '지점별 장애 복구 대응' 부분에 대한 인사이트를 얻기 위해선 이론만 익히고 로컬 환경에서 시연해보는 것 만으로는 부족하다는 걸 알게 되었습니다.

다행히 F-LAB 측에서 이러한 저의 고민을 해결해줄 수 있는 수단이 있었습니다. 바로 ncp 크레딧 70만 포인트를 지원하는 제도인데요. 사실 AWS도 써보고 싶었지만, 아무래도 요금부담이 있다보니 망설여지는 어쩔 수 없는 것 같습니다. 또한, 백엔드 개발자로서 중요한건 특정 클라우드 서비스를 잘쓰는 것보다는 네트워크를 이해하여, 주어진 클라우드 환경을 빠르게 이해하고 활용하는 것이 더 중요하기에 네트워크 학습을 하고 학습한 내용에 대한 실습으로 NCP를 활용해보고자 합니다.

이번 파트에서는 DNS를 사용하기 전에 DNS가 무엇이고 주요 특징은 무엇인지에 대해 알아보겠습니다.

## DNS의 정의

DomainNameSystem(DNS)이란 IP주소를 사람이 읽을 수 있는 도메인 이름으로 변환하는 시스템입니다. 

인터넷에 연결된 모든 장치는 고유한 IP 주소를 가지고 있습니다. DNS는 전화번호부와 같이 작동하여, 사람들이 기억하기 쉬운 도메인 이름을 사용하여 필요한 정보를 찾을 수 있게 합니다.

## DNS 특징

- 분산 구조형 데이터베이스
  - 데이터베이스 시스템(DNS 네임서버)의 분산 구성
  - 데이터의 영역별 구분(Domain Zone) 및 분산관리
  - 도메인의 네임서버 및 도메인 데이터는 해당 관리주체에 의해 독립적으로 관리됨
- 트리(tree) 구조의 도메인 네임(Domain Name) 체계
  - **Domain** : 영역, 영토를 의미. 개발자로서 해결해야할 문제를 의미하기도 합니다.
  - 도메인 네임의 자율적 생성
  - 생성된 도메인 네임은 언제나 유일(Unique)하도록 네임 체계가 구성

### Domain name

**도메인 네임과, 호스트 네임**

```
www.			naver.			com
```

- `naver. com` : `.com`에 속한 도메인 네임
- `www` : 호스트 네임

## DNS 구조

![dns drawio](https://github.com/wanniDev/payment-lab/assets/81374655/658bd0f2-ed51-4691-9529-6bb0dd639991)

세계적으로 운영되고 있는 DNS 서버는 정말 다양합니다. 하지만, 대체로 DNS 서버는 ISP(Internet Service Provider)에서 지정한 DNS를 사용합니다.

 물론, 디바이스 사용자가 DNS 서버를 직접 지정할 수 있습니다. 하지만 속도와 성능, 네트워크 경유 등 여러가지를 고려해봐도 ISP에서 지정하는 DNS를 사용하는 것이 가장 무난합니다.

### URL 입력후 DNS 서버가 IP주소를 찾아 사용자에게 화면을 보여주는 과정

dns 서버는 계층적 구조로 이루어짐. 상위로 올라가면 RootDNS 13대 정도를 볼 수 있음.

1. **로컬 DNS 캐시 확인 :** 운영체제와 브라우저는 자주 방문하는 사이트의 DNS 정보를 로컬에 저장합니다. 따라서 가장 먼저 이  로컬 DNS 캐시를 확인하여 해당 url의 IP 주소가 존재하는지 검사합니다. 있다면 해당 IP 주소로 바로 접속합니다.
2. **재귀적 DNS 쿼리 :** 로컬 캐시에 필요한 정보가 없다면, 요청은 설정된 DNS 서버(보통은 ISP가 지정함)로 전송됩니다. 이 DNS 서버(캐시 DNS라고도 합니다.)는 재귀적 DNS 서버로 작동하여 사용자를 대신해 도메인의 IP 주소를 찾습니다.
3. **루트 DNS 서버 조회**: 재귀적 DNS 서버는 루트 DNS 서버에 접속하여 ".com" 도메인에 대한 정보를 가진 최상위 도메인(TLD) 서버의 위치를 요청합니다. 루트 DNS 서버는 TLD 서버의 주소를 알려줍니다.
4. **TLD DNS 서버 조회 :** 다음으로, TLD DNS 서버는 ".com"과 같은 도메인의 네임서버 정보를 담고 있으며, 사용자가 검색하고자하는 url 도메인의 네임서버 주소를 제공합니다.
5. **도메인의 DNS 서버 조회 :** TLD 서버로부터 받은 네임서버 주소 정보를 이용하여, 이 네임서버에 직접 쿼리를 보내 해당 url의 IP 주소를 요청합니다.
6. **IP 주소 응답 :** 도메인 네임서버는 해당 url에 대한 IP 주소를 재귀적 DNS 서버에게 알려줍니다.
7. **재귀적 DNS 서버의 캐싱 :** 재귀적 DNS 서버는 이 IP 주소를 캐시에 저장하여, 같은 요청에 대해 더 빠르게 응답할 수 있도록 합니다. 캐싱된 정보는 정해진 시간(생존 시간, TTL) 동안만 유효합니다.
8. **사용자에게 IP 주소 전달 : **재귀적 DNS 서버는 최종적으로 사용자가 입력한 url 주소에 대한 IP 주소를 사용자의 컴퓨터로 반환합니다.
9. **웹사이트 접속 :** 사용자의 컴퓨터는 이 IP 주소를 사용하여 해당 서버에 접속하고 웹사이트의 데이터를 요청합니다.
10. **웹 페이지 로딩 :** 서버는 요청받은 웹 페이지 데이터를 사용자의 브라우저로 전송하고, 브라우저는 이 데이터를 해석하여 화면에 표시합니다.

이 일련의 과정은 보통 밀리초 단위로 일어나기에 사용자 입장에서는 거의 바로 접속하는 것처럼 느껴집니다. DNS 캐싱은 이러한 과정을 최적화하여 지연 시간을 줄이고, 인터넷 트래픽을 감소시키는 중요한 역할을 합니다.

### 고민해볼만한 dns 관련 주요 이슈

- dns가 거짓말을 한다면?
- dns가 해킹을 당한다면?
- dns가 다운되면?

