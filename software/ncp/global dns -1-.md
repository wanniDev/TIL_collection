# NCP로 나만의 서비스 구축해보기-2- Global DNS

바로 이전 게시글에서는 DNS의 정의와 특징에 대해 알아보았습니다. 이번에는 그 DNS를 ncp를 통해 좀 더 직관적으로 사용할 수 있는 서비스인 Global DNS에 대해 알아보겠습니다.

Global DNS는 개인이 직접 운영하기 어려운 DNS 서버를 클라우드 형태로 제공하여 사용자가 서비스 운영에 필요한 도메인을 쉽고 편리하게 관리할 수 있습니다.

Global DNS가 제공하는 기능은 다음과 같습니다.

- **최적의 글로벌 라우팅**
- **Alias(별칭 기능) 지원**
- **간편한 마이그레이션**
- **도메인별 요청 수 통계**

Global DNS의 요금은 23년 11월 9일 한국 리전을 기준으로 개인 홈페이지 기준으로 거의 무료나 다름없는 수준입니다.

|      구분      |             | 이용 요금 (월) |
| :------------: | :---------: | -------------- |
|   Zone 개수    |  25개이하   | 550 원/zone    |
|                |  25개초과   | 110 원/zone    |
| 월별 쿼리 개수 | 10억개 이하 | 440 원/백만개  |
|                | 10억개 초과 | 220 원/백만개  |

> 출처 : https://www.ncloud.com/charge/region/ko

## 도메인 등록 메커니즘

> ncp의 장점이라 생각되는 부분인데요. 공식문서가 너무 잘 정리되어있습니다. 따로 각색할 필요도 없을정도로요. 그래서 학습을 목적으로 '필사'를 한다고 생각하여 해당 문서를 그대로 적어보았습니다.
>
> https://guide.ncloud-docs.com/docs/globaldns-info

도메인을 사용하려면 먼저 도메인을 구매해야합니다. 그리고 도메인명과 실제 IP 주소의 매핑 정보를 담은 네임 서버를 두어야 합니다. Global DNS를 사용하면 클라우드 환경에서 네임 서버를 구축할 수 있으나 새로운 도메인명을 구매할 수는 없습니다.

따라서, 도메인은 가비아, 아이네임즈, 닷네임코리아 등 인증된 등록 기관에서 먼저 도메인명을 신규 등록하고, Global DNS를 통해 네임 서버를 구축해야 합니다.

## DNS 레코드 타입

DNS 레코드란 DNS 상에서 도메인에 관한 설정을 하기 위해 사용되는 일련의 문자들을 이야기합니다. Global DNS에서 사용할 수 있는 DNS 레코드 타입은 다음과 같습니다.

### SOA 레코드

- SOA는 Start of Authority의 약자로, 도메인 영역(zone)에 대한 중요 정보를 이야기합니다.
- Global DNS에서는 도메인이 추가되면 SOA 레코드가 자동으로 생성되며, 레코드를 추가, 수정, 삭제할 수 없습니다.
- 레코드 형태 : {도메인 네임 서버} {Serial} {Refresh} {Retry} {Expire} {TTL}
  - Serial : 도메인 영역의 버전 번호
  - Refresh : 도메인 영역의 데이터 갱신 주기
  - Retry : 도메인 영역의 데이터 갱신 주기 확인 실패 시 재시도하는 주기
  - Expire : Retry의 계속된 실패로 도메인 영역을 폐기하는 주기
  - TTL : 레코드 변경 사항의 적용 주기

### A 레코드

- 도메인명을 IPv4 주소로 매핑합니다.
- 하나의 도메인명에 여러 개의 IP 주소를 매핑할 수 있으며, 요청 수에 따라 Round Robin(순환) 순서로 여러 IP를 응답하게 됩니다.
- TTL 기본값은 300초(5분)이며, TTL을 너무 높게 설정하면 레코드값을 변경할 때 반영이 지연됩니다.
- 입력 예시
  - 레코드명: www.example.com
  - 레코드값: 10.0.0.1

### AAAA 레코드

- 도메인명을 IPv6 주소로 매핑합니다.
- A 레코드와 마찬가지로 하나의 도메인명에 여러 개의 IP 주소를 매핑할 수 있으며, 요청 수에 따라 Round Robin(순환) 순서로 여러 IP를 응답하게 됩니다.
- TTL 기본값은 300초(5분)이며, TTL을 너무 높게 설정하면 레코드값을 변경할 때 반영이 지연됩니다.
- 입력 예시
  - 레코드명: www.example.com
  - 레코드값: 2001:0db8:85a3:0000:0000:8a2e:0370:7334

### NS 레코드

- 도메인의 네임 서버 정보를 나타냅니다.
- Global DNS에서는 도메인이 추가되면 NS 레코드가 자동으로 생성되며, 레코드값을 추가, 수정, 삭제할 수 없습니다.
  - 제공되는 레코드값: ns1-1.ns-ncloud.com, ns1-2.ns-ncloud.com
- TTL 기본값은 86400초(1일)이며, 수정할 수 있습니다.

### PTR 레코드

- PTR은 Pointer의 약자로, A 또는 AAAA 레코드와 반대로 IP 주소를 도메인으로 매핑합니다.
- Reverse 도메인에 대한 레코드로, 호스트/서비스 식별, 메일 주소의 유효성 검사 등의 용도로 사용합니다.
- 도메인명 및 IP 주소를 역방향으로 표기하고 마침표(.)로 구분합니다.
- 예시: www.ncloud.com A 49.236.142.51의 PTR 레코드 생성 방법
  - 142.236.49.in-addr.arpa 도메인 생성 > 레코드 추가 > 레코드명: 51 입력, PTR 타입 선택, 레코드값: www.ncloud.com 입력

### CNAME 레코드

- CNAME은 Canonical Name의 약자로, 하나의 도메인명에 다른 도메인명을 별칭으로 정의하여 매핑합니다.
- CNAME 레코드는 다른 모든 레코드와 충돌하므로, 하나의 호스트에 이 레코드를 추가하면 다른 레코드는 추가할 수 없습니다.
- 루트 도메인에는 CNAME 레코드를 추가할 수 없습니다. 루트 도메인에서 이 기능을 사용하려면 Global DNS에서 제공하는 Alias 기능을 사용해 주십시오.
- 입력 예시
  - 레코드명: www.example.com
  - 레코드값: www1.example.com

### MX 레코드

- 메일 서비스를 이용하는 목적으로 도메인 영역에 대한 메일 라우팅 도메인을 설정하기 위해 사용합니다.
- 레코드값은 FQDN(Fully qualified domain name)으로 입력합니다.
- 여러 대의 메일 서버를 입력하려면 개행으로 구분하고, Preference 값을 앞에 추가합니다. 값이 작을수록 높은 우선순위를 가집니다.
- 입력 예시
  - 레코드명: @.ncloudtest.com
  - 레코드값:
    - 10 mx1.ncloudtest.com
    - 20 mx2.ncloudtest.com

### SPF 레코드

- SPF는 Sender Policy Framework의 약자로, 메일 발송 서버를 인증하는 기술입니다.
- SPF 레코드를 설정하면 수신자가 발신 메일의 정보와 SPF 레코드를 대조하여 메일의 위조 여부를 확인할 수 있습니다.
- SPF 레코드에 등록되지 않은 서버에서 보낸 메일은 스팸 처리됩니다.
- 입력 예시
  - 레코드명: @.example.com
  - 레코드값: v=spf1 include:_spfblocka.ncloudtest.com include:_spfblockb.ncloudtest.com ~all

### TXT 레코드

- 임의의 문자열로 구성된 텍스트 레코드로, 도메인에 대한 간단한 텍스트 데이터를 입력할 수 있습니다.
- 도메인 소유권 확인, SPF로 발신자 권한 부여, 디지털 전자 메일 시그니처 추가(DKIM) 및 스팸 발신 방지 등 다양한 용도로 사용될 수 있습니다.
- 입력 예시
  - 레코드명: @.example.com
  - 레코드값: "favorite drink=orange juice"

### SRV 레코드

- SRV는 Service의 약자로, DNS에서 서비스의 위치(호스트명과 포트 번호)를 저장합니다.
- 여러 개의 서버 나열 시 우선순위(priority) 및 가중치(weight)를 나타낼 수 있습니다.
- 우선순위가 높은 서버는 다른 서버보다 더 많은 트래픽을 수신하며, 우선순위 값이 같은 서버들 안에서는 가중치가 높은 서버가 다른 서버보다 더 많은 트래픽을 수신합니다.
- 레코드 형태: `_{서비스}._{프로토콜}.{도메인} SRV {우선순위} {가중치} {포트 번호} {타깃}`
- 입력 예시
  - 레코드명: _kerberos._tcp.ncloudtest.com
  - 레코드 타입: SRV
  - 레코드값: 10 60 88 kerberos.ncloudtest.com

### CAA 레코드

- 도메인에 대한 인증서를 발급할 수 있는 CA(인증 기관)를 지정합니다.
- 잘못된 CA가 도메인에 대한 인증서를 발급하는 것을 방지할 수 있습니다.
- 레코드 형태: {flags} {tag} "{value}"
  - flags: 0~255까지의 값을 설정
  - tag: issue 또는 issuewild 값으로 설정
  - value: 지정된 tag 값에 따라 value 값을 입력
- 입력 예시
  - 레코드명: ca.example.com
  - 레코드값: 0 issue "ncloud.com"

### DS 레코드

- DNSSEC 활성화 시 보안이 위임된 영역에 사용되는 DNSSEC 키 지문이며, 하위 도메인의 신뢰성을 확인하는 데에 사용됩니다.
- Global DNS에서는 DNSSEC가 활성화되면 DS 레코드가 자동으로 생성됩니다.
- 레코드 형태: {키 태그} {알고리즘} {다이제스트 유형} {다이제스트}
  - 키 태그: 레코드 식별을 위해 사용되는 숫자 값
  - 알고리즘: DNSKEY 레코드(도메인 영역의 공개 서명 키가 있는 레코드)의 보안 키를 만드는 데 사용하는 암호화 알고리즘. RSA/SHA1과 같은 해시 함수와 쌍을 이룸.
    - 1(SHA1)은 잠재적인 위협이 될 수 있으니 유의해 주십시오.
  - 다이제스트 유형: DNSKEY 레코드의 다이제스트를 만드는 데 사용하는 알고리즘
  - 다이제스트: DNSKEY 레코드의 해시된 값으로, 레코드를 고유하게 식별
- 입력 예시
  - 레코드명: ds.example.com
  - 레코드값:
    36061 8 2 b7b5c0f2c4917d6eacc9ba4461e6ae693d7a366823530b385168cc842492c271
    36061 8 4 938888f1b4185ed56e65bbc63470d712decc509c1caf1682173134e2d833b8d3676965cc7084d5b1254ca21a62eaf94c

