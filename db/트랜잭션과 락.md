# 트랜잭션과 락

MySQL의 동시성에 영향을 주는 요소로 락(Lock)과 트랜잭션, 그리고 트랜잭션의 격리 수준(Isolation)이 있습니다.

트랜잭션은 작업의 완전성을 보장해줍니다. All or Noting 이라고 하죠. 따라서 트랜잭션은 일련의 논리적인 작업 단위를 모두 완변하게 처리하거나, 하나라도 잘못되면 원 상태로 복구시켜주어야 할 때 매우 유용합니다.

때론 락과 트랜잭션을 비슷한 개념으로 볼 수도 있지만, 사실 **락은 동시성을 제어하기 위한 기능**이고, **트랜잭션은 데이터의 정합성을 보장하기 위한 기능**입니다.

락은 여러 커넥션에서 동시에 동일한 레코드나 테이블을 요청할 경우 순서대로 한 시점에 하나의 커넥션만 접근할 수 있게 해주는 역할을 합니다.

격리 수준은 하나의 트랜잭션 내에서 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지를 결정하는 레벨을 의미 합니다.

## 1. 트랜잭션

MySQL은 MyISAM, MEMORY와 같이 트랜잭션을 지원하지 않는 스토리지엔진도 있지만, InnoDB처럼 트랜잭션을 지원하는 엔진도 있습니다. 대부분 처리 속도만을 보면, InnoDB은 다소 느릴 수 있지만, 하드웨어 수준이 높아지고, InnoDB 자체의 성능도 많이 개선된 현 시점에서는 개발자의 고민거리를 덜어주는 트랜잭션을 지원하는 InnoDB를 대부분 사용합니다.

이번 글에서는 InnoDB의 트랜잭션 처리방식만을 정리해보겠습니다.

MySQL의 트랜잭션은 앞서 이야기 했듯이 작업의 단위가 100% 적용되거나 아무것도 적용되지 않아야 함을 보장합니다.

스프링의 경우 트랜잭션의 단위를 `@Transactional`로 간단하게 묶을 수 있습니다.

**주의사항**

될 수 있으면 트랜잭션의 범위는 최소화하는 것이 좋습니다. 만약에 하나의 트랜잭션 범위에 FTP 파일 전송 또는 네트워크를 통한 원격 서버와 통신하는 등과 같은 작업은 최대한 트랜잭션 내에서 제거하는 것이 좋습니다.

## 2. MySQL 엔진 락

MySQL 엔진의 락은 MySQL 서버에서 스토리지 엔진을 제외한 나머지 부분을 이해하면 됩니다. MySQL 엔진의 잠금은 모든 스토리지 엔진에 영향을 미칩니다. 스토리지 엔진 레벨의 잠금은 스토리지 엔진 간 테이블의 구조를 잠그는 메타데이터 락(Metadata Lock) 그리고 사용자의 필요에 맞게 사용할 수 있는 네임드 락(Named Lock)이라는 잠금도 제공합니다.